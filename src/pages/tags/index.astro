---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');

function slugify(str: string): string {
  return str.toLowerCase().replace(/\s+/g, '-');
}

const tagMap = new Map<string, number>();
posts.forEach((post) => {
  post.data.tags.forEach((tag) => {
    if (tag) {
      tagMap.set(tag, (tagMap.get(tag) || 0) + 1);
    }
  });
});

const tags = [...tagMap.entries()].sort((a, b) =>
  a[0].localeCompare(b[0])
);
---

<BaseLayout
  title="Tags"
  description="Browse all blog post tags."
>
  <h1 class="page-heading">Tags</h1>
  <ul class="taxonomy-grid">
    {tags.map(([name, count]) => (
      <li class="taxonomy-card">
        <a href={`/tag/${slugify(name)}/`}>{name}</a>
        <span class="taxonomy-card__count">
          {count} {count === 1 ? 'post' : 'posts'}
        </span>
      </li>
    ))}
  </ul>
</BaseLayout>
